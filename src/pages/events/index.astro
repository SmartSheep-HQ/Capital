---
import PageLayout from "../../layouts/PageLayout.astro";

import { graphQuery } from "../../scripts/requests";
import { DocumentRenderer } from "@keystone-6/document-renderer";

export const prerender = false;

const { events } = (
  await graphQuery(
    `query Query($where: EventWhereInput!) {
  events(where: $where) {
    slug
    title
    description
    content {
      document
    }
    createdAt
  }
}`,
    {
      where: {
        isHistory: {
          equals: true,
        },
      },
    }
  )
).data;
---

<PageLayout>
  <div class="max-w-[720px] mx-auto">
    <div class="card w-full shadow-xl">
      <div class="card-body">
        <h2 class="card-title">活动</h2>
        <p>读岁月史书，涨人生阅历</p>
        <div class="divider"></div>

        <ul
          class="timeline timeline-snap-icon max-md:timeline-compact timeline-vertical"
        >
          {
            events?.map((item: any, idx: number) => {
              let align = idx % 2 === 0 ? "timeline-start" : "timeline-end";
              let textAlign = idx % 2 === 0 ? "md:text-right" : "md:text-left";

              return (
                <li>
                  {idx > 0 && <hr />}
                  <div class="timeline-middle">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      class="h-5 w-5"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </div>
                  <div class={`${align} ${textAlign} mb-10`}>
                    <time class="font-mono italic">
                      {new Date(item.createdAt).toLocaleDateString()}
                    </time>
                    <div class="text-lg font-black">{item.title}</div>
                    <DocumentRenderer document={item.content.document} />
                  </div>
                  <hr />
                </li>
              );
            })
          }
        </ul>
        <div class="text-center max-md:text-left italic">
          我们的故事还在继续……
        </div>
      </div>
    </div>
  </div>
</PageLayout>